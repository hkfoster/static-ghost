
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Feature Highlight: maxTimeMS in MongoDB 2.6</title>
  <meta name="description" content="">

  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="shortcut icon" href="../favicon.ico">

  <script>
  // Uncomment for testing purposes
  // localStorage.clear();
  
  // Place in <head> above all stylesheet declarations
  function loadFont( fontName, woffUrl, woff2Url ) {
  
    // Test for support
    var browser   = navigator.userAgent,
        noSupport = !window.addEventListener || ( browser.match( /(Android (2|3|4.0|4.1|4.2|4.3))|(Opera (Mini|Mobi))/ ) && !browser.match( /Chrome/ ) );
  
    // Return if not supported
    if ( noSupport ) {
      return;
    }
  
    // Set up localStorage
    var loSto = {};
    try {
      loSto = localStorage || {};
    } catch ( ex ) {}
  
    var localStoragePrefix = 'x-font-' + fontName,
        localStorageUrlKey = localStoragePrefix + 'url',
        localStorageCssKey = localStoragePrefix + 'css',
        storedFontUrl      = loSto[ localStorageUrlKey ],
        storedFontCss      = loSto[ localStorageCssKey ];
  
    // Set up <style> element
    var styleElement = document.createElement( 'style' );
    styleElement.rel = 'stylesheet';
    document.head.appendChild( styleElement );
  
    // localStorage check
    if ( storedFontCss && ( storedFontUrl === woffUrl || storedFontUrl === woff2Url ) ) {
  
      // Apply font style sheet
      styleElement.textContent = storedFontCss;
  
    } else {
  
      // Apply new font (WOFF2 if supported)
      var url = ( woff2Url && supportsWoff2() ) ? woff2Url : woffUrl;
  
      // Fetch font data
      var request = new XMLHttpRequest();
      request.open( 'GET', url );
      request.onload = function() {
        if ( request.status >= 200 && request.status < 400 ) {
  
          // Update localStorage
          loSto[ localStorageUrlKey ] = url;
          loSto[ localStorageCssKey ] = styleElement.textContent = request.responseText;
        }
      };
      request.send();
    }
  
    // Check for WOFF2 support
    function supportsWoff2() {
      if ( !window.FontFace ) {
        return false;
      }
  
      var f = new FontFace( 't', 'url( "data:application/font-woff2," ) format( "woff2" )' );
      f.load();
  
      return f.status === 'loading';
    }
  }
  
  // Instantiate font loader
  loadFont(
    'Proxima Nova',
    '/assets/css/fonts-woff.css?v=682061ecfb',
    '/assets/css/fonts-woff2.css?v=682061ecfb'
  );
  </script>
  <link rel="stylesheet" type="text/css" href="../assets/css/style.css?v=682061ecfb">

  <link rel="canonical" href="http://localhost:2368/feature-highlight-maxtimems-in-mongodb-2-6/">
    
    <meta property="og:site_name" content="Compose Articles">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Feature Highlight: maxTimeMS in MongoDB 2.6">
    <meta property="og:description" content="It’s probably happened to you before — you have an idea in your head and you want to run an operation against your database to show you the data that will answer your question or find the result you want...">
    <meta property="og:url" content="http://localhost:2368/feature-highlight-maxtimems-in-mongodb-2-6/">
    <meta property="article:published_time" content="2014-04-17T16:13:24.000Z">
    <meta property="article:modified_time" content="2014-09-02T09:32:22.000Z">
    <meta property="article:tag" content="performance">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Feature Highlight: maxTimeMS in MongoDB 2.6">
    <meta name="twitter:description" content="It’s probably happened to you before — you have an idea in your head and you want to run an operation against your database to show you the data that will answer your question or find the result you want...">
    <meta name="twitter:url" content="http://localhost:2368/feature-highlight-maxtimems-in-mongodb-2-6/">
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Compose Articles",
    "author": {
        "@type": "Person",
        "name": "jasonmongohq-com",
        "image": "//www.gravatar.com/avatar/3548295c7883a0a9f80434be86939cd4?d=404&s=250",
        "url": "http://localhost:2368/author/jasonmongohq-com",
        "sameAs": "http://www.mongohq.com"
    },
    "headline": "Feature Highlight: maxTimeMS in MongoDB 2.6",
    "url": "http://localhost:2368/feature-highlight-maxtimems-in-mongodb-2-6/",
    "datePublished": "2014-04-17T16:13:24.000Z",
    "dateModified": "2014-09-02T09:32:22.000Z",
    "keywords": "performance",
    "description": "It’s probably happened to you before — you have an idea in your head and you want to run an operation against your database to show you the data that will answer your question or find the result you want..."
}
    </script>

    <meta name="generator" content="Ghost 0.5">
    <link rel="alternate" type="application/rss+xml" title="Compose Articles" href="http://localhost:2368/rss/">
</head>

<body class="post-template tag-performance blend-mode">

  <header class="branding" role="banner">
    <a class="logo" href="../"><span class="hidden">Compose</span></a>
    <a class="menu-trigger" href="index.html#?"></a>
    <nav class="main-nav" data-yield="primary_nav" role="navigation">
      <a href="http://127.0.0.1:2368/mongodb/">MongoDB</a>
      <a href="http://127.0.0.1:2368/elasticsearch/">Elasticsearch</a>
      <a href="http://127.0.0.1:2368/rethinkdb/">RethinkDB</a>
      <a href="http://127.0.0.1:2368/redis/">Redis</a>
      <a href="http://127.0.0.1:2368/postgresql/">PostgreSQL</a>
      <a href="https://app.compose.io">Sign in</a>
      <a class="signup" href="../signup/">Sign up</a>
    </nav>
  </header>
  <main class="content container" role="main">

    


<article class="post tag-performance container">
  <header>
    <h1 class="post-title">Feature Highlight: maxTimeMS in MongoDB 2.6</h1>
    <small class="post-meta"><time class="post-date" datetime="2014-04-17">April 17th, 2014</time></small>
  </header>

<p>It’s probably happened to you before — you have an idea in your head and you want to run an operation against your database to show you the data that will answer your question or find the result you want to act on.</p>

<p>You conjure the query. <br>
 You type out the query. <br>
 You submit the query. <br>
 You wait. <br>
 You muse … “Wow, this should have come back quickly.” <br>
 You investigate and discover your error … “oh man, that field isn’t indexed.”</p>

<h3 id="whattodo">What to do</h3>

<p>Now, you’re visualizing hundreds of thousands of documents being meticulously scanned, memory churning, IO utilization increasing, <a href="http://rapgenius.com/8078">palms are sweaty, knees weak, arms are heavy</a>, and so on. Do you allow the query to finish or do you start querying <a href="http://docs.mongodb.org/manual/reference/method/db.currentOp/">currentOps</a> to find the offending operation, get its ID, and move to terminate it?</p>

<p>A nifty new feature in MongoDB 2.6 helps you avoid situations like this by fitting an ejector seat, with timer, to your query. It’s called <strong>maxTimeMS</strong>. In your MongoDB console (or also supported by an increasing amount of MongoDB drivers), you can do the following:</p>

<p><code>db.eminem_songs.find({title: "Lose Yourself"}).maxTimeMS(500)</code></p>

<p><aside class="left-gutter"><dl><dt>Only CPU Time</dt><dd> The maxTimeMS flag only accounts for CPU time and does not include network latency or idle time. </dd></dl></aside>Now, if this operation takes more than 500 milliseconds to return, MongoDB automatically gives up and terminates the operation for you. Nice, right? This flag allows the CPU to spend a user-defined amount of time working to generate a result.</p>

<h3 id="driversupport">Driver support</h3>

<p>The <strong>maxTimeMS</strong> flag is an option that was added to the MongoDB protocol for cursors. Therefore, support for it is steadily being rolled out in clients such as the MongoDB console and popular MongoDB community drivers.</p>

<h3 id="scenarioswheremaxtimemswouldbeuseful">Scenarios where maxTimeMS would be useful</h3>

<p>There are a number of scenarios where a flag like this can be helpful. For example, if you are in discovery mode and want to protect your database performance against unintended runaway operations, you could ensure all your queries include this flag.</p>

<p>Another scenario would be the batching of results, allowing you to define the amount of time/effort the database should spend returning results until it quits and moves on to the next request. In this situation, the cursor would continue to return results until the allotted amount of time has expired.</p>

<p>This is a nice features to keep in your toolset for the right occasion. It isn’t something you would use every day, but when you do, you’ll be glad you had it.</p>

<h3 id="giveitago">Give it a go!</h3>

<p><a href="http://www.mongohq.com/features/">MongoHQ Elastic Deployments</a> now include the option to run MongoDB 2.6. So, if you want to try maxTimeMS (and a number of other great features), it is <a href="http://www.mongohq.com/signup/">easy to get started</a>.</p>


<footer class="post-footer big-push">


    <figure class="author">
      <a href="../author/jasonmongohq-com/">
        <img src="http://www.gravatar.com/avatar/3548295c7883a0a9f80434be86939cd4?d=404&amp;s=250" alt="jasonmongohq-com">
      </a>
      <figcaption>
        <p>Written on <time class="post-date" datetime="2015-03-13">March 13th, 2015</time> by</p>
        <a href="../author/jasonmongohq-com/">jasonmongohq-com</a>
          <p>0</p>
      </figcaption>
    </figure>




  <nav class="post-nav">
    <section class="site-nav">
      <a class="article-index" data-tooltip="Article Index" href="http://localhost:2368">
        <span class="hidden">Article Index</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#index"></use>
        </svg>
      </a>
      <a class="subscribe-button" data-tooltip="Suscribe" href="http://localhost:2368/rss/">
        <span class="hidden">Subscribe</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#subscribe"></use>
        </svg>
      </a>
    </section>
    <section class="share-nav">
      <a class="twitter-button" data-tooltip="Share on Twitter" href="https://twitter.com/share?text=Feature%20Highlight%3A%20maxTimeMS%20in%20MongoDB%202.6&amp;url=http://localhost:2368/feature-highlight-maxtimems-in-mongodb-2-6/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#twitter"></use>
        </svg>
      </a>
      <a class="facebook-button" data-tooltip="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:2368/feature-highlight-maxtimems-in-mongodb-2-6/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#facebook"></use>
        </svg>
      </a>
      <a class="google-plus-button" data-tooltip="Share on Google Plus" href="https://plus.google.com/share?url=http://localhost:2368/feature-highlight-maxtimems-in-mongodb-2-6/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#google-plus"></use>
        </svg>
      </a>
    </section></nav>
  
</footer>

</article>



  </main>

  <footer class="colophon full-push" role="contentinfo">
    <nav>
      <dl>
        <dt>Company</dt>
        <dd><a href="http://127.0.0.1:2368/about-us/">About Us</a><a href="http://blog.compose.io/">Blog</a><a href="http://docs.compose.io/policies">Policies</a><a href="http://127.0.0.1:2368/pricing/">Plans <span class="amp">&amp;</span> Pricing </a><a href="http://127.0.0.1:2368/database-as-a-service/">Database as a Service</a>
        </dd>
      </dl>
      <dl>
        <dt>Support</dt>
        <dd><a href="http://status.compose.io/">System Status</a><a href="http://docs.compose.io/">Support</a><a href="http://docs.compose.io/">Docs</a><a href="http://127.0.0.1:2368/security/">Security</a><a href="https://docs.compose.io/support/new_request.html/?page=www">Contact Us</a>
        </dd>
      </dl>
      <dl>
        <dt>Databases</dt>
        <dd><a href="http://127.0.0.1:2368/mongodb/">MongoDB</a><a href="http://127.0.0.1:2368/elasticsearch/">Elasticsearch</a><a href="http://127.0.0.1:2368/rethinkdb/">RethinkDB</a><a href="http://127.0.0.1:2368/redis/">Redis</a><a href="http://127.0.0.1:2368/enhanced/">Enhanced</a>
        </dd>
      </dl>
      <dl>
        <dt>Deployments</dt>
        <dd><a href="http://127.0.0.1:2368/aws/">AWS</a><a href="http://127.0.0.1:2368/digitalocean/">DigitalOcean</a><a href="http://127.0.0.1:2368/softlayer/">SoftLayer</a><a href="http://127.0.0.1:2368/gogrid/">GoGrid</a>
        </dd>
      </dl>
    </nav>
    <p>© 2015 Compose. All rights reserved. </p>
  </footer>
  <script src="../public/jquery.js?v=682061ecfb"></script>

  <script type="text/javascript" src="../assets/js/site.js?v=682061ecfb"></script>

</body>
