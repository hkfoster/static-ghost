
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Connecting to Compose's RethinkDB deployments with SSH</title>
  <meta name="description" content="">

  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="shortcut icon" href="../favicon.ico">

  <script>
  // Uncomment for testing purposes
  // localStorage.clear();
  
  // Place in <head> above all stylesheet declarations
  function loadFont( fontName, woffUrl, woff2Url ) {
  
    // Test for support
    var browser   = navigator.userAgent,
        noSupport = !window.addEventListener || ( browser.match( /(Android (2|3|4.0|4.1|4.2|4.3))|(Opera (Mini|Mobi))/ ) && !browser.match( /Chrome/ ) );
  
    // Return if not supported
    if ( noSupport ) {
      return;
    }
  
    // Set up localStorage
    var loSto = {};
    try {
      loSto = localStorage || {};
    } catch ( ex ) {}
  
    var localStoragePrefix = 'x-font-' + fontName,
        localStorageUrlKey = localStoragePrefix + 'url',
        localStorageCssKey = localStoragePrefix + 'css',
        storedFontUrl      = loSto[ localStorageUrlKey ],
        storedFontCss      = loSto[ localStorageCssKey ];
  
    // Set up <style> element
    var styleElement = document.createElement( 'style' );
    styleElement.rel = 'stylesheet';
    document.head.appendChild( styleElement );
  
    // localStorage check
    if ( storedFontCss && ( storedFontUrl === woffUrl || storedFontUrl === woff2Url ) ) {
  
      // Apply font style sheet
      styleElement.textContent = storedFontCss;
  
    } else {
  
      // Apply new font (WOFF2 if supported)
      var url = ( woff2Url && supportsWoff2() ) ? woff2Url : woffUrl;
  
      // Fetch font data
      var request = new XMLHttpRequest();
      request.open( 'GET', url );
      request.onload = function() {
        if ( request.status >= 200 && request.status < 400 ) {
  
          // Update localStorage
          loSto[ localStorageUrlKey ] = url;
          loSto[ localStorageCssKey ] = styleElement.textContent = request.responseText;
        }
      };
      request.send();
    }
  
    // Check for WOFF2 support
    function supportsWoff2() {
      if ( !window.FontFace ) {
        return false;
      }
  
      var f = new FontFace( 't', 'url( "data:application/font-woff2," ) format( "woff2" )' );
      f.load();
  
      return f.status === 'loading';
    }
  }
  
  // Instantiate font loader
  loadFont(
    'Proxima Nova',
    '/assets/css/fonts-woff.css?v=682061ecfb',
    '/assets/css/fonts-woff2.css?v=682061ecfb'
  );
  </script>
  <link rel="stylesheet" type="text/css" href="../assets/css/style.css?v=682061ecfb">

  <link rel="canonical" href="http://localhost:2368/connecting-to-composes-rethinkdb-deployments-with-ssh/">
    
    <meta property="og:site_name" content="Compose Articles">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Connecting to Compose's RethinkDB deployments with SSH">
    <meta property="og:description" content="If you install RethinkDB on your local system, you will see that it, by design, happily accepts connections from anywhere without authentication. This is great for development but does mean you have to think about how you deploy RethinkDB when...">
    <meta property="og:url" content="http://localhost:2368/connecting-to-composes-rethinkdb-deployments-with-ssh/">
    <meta property="og:image" content="http://localhost:2368/content/images/2014/12/workstation-336369_1920_pcj48h_s6tdzr.jpg">
    <meta property="article:published_time" content="2014-10-16T07:45:50.000Z">
    <meta property="article:modified_time" content="2014-12-17T09:19:09.000Z">
    <meta property="article:tag" content="configure">
    <meta property="article:tag" content="rethinkdb">
    <meta property="article:tag" content="ssh">
    <meta property="article:tag" content="ssh tunnel">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Connecting to Compose's RethinkDB deployments with SSH">
    <meta name="twitter:description" content="If you install RethinkDB on your local system, you will see that it, by design, happily accepts connections from anywhere without authentication. This is great for development but does mean you have to think about how you deploy RethinkDB when...">
    <meta name="twitter:url" content="http://localhost:2368/connecting-to-composes-rethinkdb-deployments-with-ssh/">
    <meta name="twitter:image:src" content="http://localhost:2368/content/images/2014/12/workstation-336369_1920_pcj48h_s6tdzr.jpg">
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Compose Articles",
    "author": {
        "@type": "Person",
        "name": "Dj",
        "image": "//www.gravatar.com/avatar/3c427b45eb4d51770a5ec7f9e4d62c9f?d=404&s=250",
        "url": "http://localhost:2368/author/dj",
        "sameAs": ""
    },
    "headline": "Connecting to Compose&#x27;s RethinkDB deployments with SSH",
    "url": "http://localhost:2368/connecting-to-composes-rethinkdb-deployments-with-ssh/",
    "datePublished": "2014-10-16T07:45:50.000Z",
    "dateModified": "2014-12-17T09:19:09.000Z",
    "image": "http://localhost:2368/content/images/2014/12/workstation-336369_1920_pcj48h_s6tdzr.jpg",
    "keywords": "configure, rethinkdb, ssh, ssh tunnel",
    "description": "If you install RethinkDB on your local system, you will see that it, by design, happily accepts connections from anywhere without authentication. This is great for development but does mean you have to think about how you deploy RethinkDB when..."
}
    </script>

    <meta name="generator" content="Ghost 0.5">
    <link rel="alternate" type="application/rss+xml" title="Compose Articles" href="http://localhost:2368/rss/">
</head>

<body class="post-template tag-configure tag-rethinkdb-2 tag-ssh tag-ssh-tunnel blend-mode">

  <header class="branding" role="banner">
    <a class="logo" href="../"><span class="hidden">Compose</span></a>
    <a class="menu-trigger" href="index.html#?"></a>
    <nav class="main-nav" data-yield="primary_nav" role="navigation">
      <a href="http://127.0.0.1:2368/mongodb/">MongoDB</a>
      <a href="http://127.0.0.1:2368/elasticsearch/">Elasticsearch</a>
      <a href="http://127.0.0.1:2368/rethinkdb/">RethinkDB</a>
      <a href="http://127.0.0.1:2368/redis/">Redis</a>
      <a href="http://127.0.0.1:2368/postgresql/">PostgreSQL</a>
      <a href="https://app.compose.io">Sign in</a>
      <a class="signup" href="../signup/">Sign up</a>
    </nav>
  </header>
  <main class="content container" role="main">

    


<article class="post tag-configure tag-rethinkdb-2 tag-ssh tag-ssh-tunnel container">
  <header class="hero cover-image container" style="background-image: url(../content/images/2014/12/workstation-336369_1920_pcj48h_s6tdzr.jpg)">
    <h1 class="post-title">Connecting to Compose's RethinkDB deployments with SSH</h1>
    <small class="post-meta"><time class="post-date" datetime="2014-10-16">October 16th, 2014</time></small>
  </header>

<p>If you install RethinkDB on your local system, you will see that it, by design, happily accepts connections from anywhere without authentication. This is great for development but does mean you have to think about how you deploy RethinkDB when you go into production. At Compose we’ve already done that thinking – our RethinkDB deployments run on their own private, isolated networks and the only way to connect to them is by using our SSH access portal. This portal lets you create an SSH tunnel from your system into that private network.</p>

<p><img src="../content/images/2014/12/composerethinkerwithkeys_qbmknw_y4wwcg.png" alt="Compose Rethinker with Keys" title="">The first thing you will need before you start is some SSH keys. Now, the process for generating these varies slightly from platform to platform, but here are the steps for Mac and Linux:</p>

<p>First check you haven’t already got keys. Open a terminal and run <code>ls -la ~/.ssh</code> which will display the keys already generated. You want to see if there’s an <code>id_rsa.pub</code> there. If there is, you’ve already made a key and – providing you remember the passphrase you set for it – you should skip to the “Putting your key in” section below. For the rest of you, it’s time to cut some keys.</p>

<h2 id="cuttingyourkeys">Cutting your keys</h2>

<p>Open the terminal again and type</p>

<pre><code>ssh-keygen -t rsa -C "your_email_address"  
</code></pre>

<p>You’ll be asked where to save the key, just press enter for the default. You’ll then be asked for a passphrase. Choose a strong phrase – ideally a reasonably long one too. Once you’ve entered it, hit return and enter it again to verify that you actually entered what you think you entered. The key generator will then start up and will write out two files, <code>id_rsa</code> (the private part of your key that you hold on to) and <code>id_rsa.pub</code> (the public part you give to other people).</p>

<h3 id="puttingyourkeyin">Putting your key in</h3>

<p>Now we are ready to set up the SSH access portal. Go to the Compose dashboard and select your RethinkDB deployment. Then select <code>Users</code> on the menu. This shows the currently configured SSH users and should, if this is a new deployment, have no users listed and an <code>Add user</code> button in the top right. Click that and you’ll get to this screen:</p>

<p><img src="../content/images/2014/12/Screenshot-2014-10-08-13_37_21_sfop1j_evyzws.png" alt="Compose Add SSH User" title="">The title field is there so you can give the key a meaningful unique name – fill it in with whatever will identify the key best for you. The <code>Key</code> text field is where we need to put the public part of our key in – you will need to copy the contents of the <code>ida_rsa.pub</code> file to that area. There are a few ways to do this. On a Mac, you can use the <code>pbcopy</code> command to load it into the clipboard like so:</p>

<pre><code>pbcopy &lt; ~/.ssh/id_rsa.pub  
</code></pre>

<p>And then click in the key field and press Command-V to paste it in. On Linux, you could install xclip and then run:</p>

<pre><code>xclip -sel clip &lt; ~/.ssh/id_rsa.pub  
</code></pre>

<p>To copy the file to the clipboard and Control-V to paste it in. Or you can just display the file in the terminal and cut-and-paste the output into the text area. The public key begins with <code>ssh-rsa</code> and a space and then is one long sequence of various characters ending in another space and finally the email address you used when you created it. You’ll need all of this text, including the <code>ssh-rsa</code> and email address when you copy and paste.</p>

<p>When you’ve got that in click the <code>Add user</code> button and your new SSH user will be created.</p>

<h2 id="diggingthetunnel">Digging the tunnel</h2>

<p>What an SSH tunnel does is redirect local ports to a remote system, forwarding all the traffic over an encrypted channel. It uses the SSH command to establish the connection and then, instead of running a command remotely, SSH is told to listen to various local ports for traffic. When a program accesses those ports, SSH then replicates the communication with the port at the other end of SSH connection. This is all configured on an SSH command line, but you don’t have to work out what that command line should be.</p>

<p>If you go to the Overview of your RethinkDB deployment, you’ll see the top entry contains Connect Strings for creating the tunnel. For example, this is the admin UI connect string for an example deployment:</p>

<p><img src="../content/images/2014/12/Screenshot-2014-10-14-14_40_55_khfe9c_uvh29k.png" alt="SSH Connection Overview" title="">The important part, as far as getting to the Admin user interface, is the second connect string. In our example above, that’s this block.</p>

<pre><code>ssh -N compose@portal.0.dblayer.com -p 10021  
-L 127.0.0.2:8080:10.100.80.34:8080 
-L 127.0.0.3:8080:10.100.80.35:8080 
-L 127.0.0.4:8080:10.100.80.36:8080 
</code></pre>

<p>It invokes the <code>ssh</code> command with the <code>-N</code> flag to stop it from starting any commands. The next part, <code>compose@portal.0.dblayer.com</code>, is the user (always compose) and host to connect to. The <code>-p</code> then specifies a port on that host to connect to. The port number will be different for every deployment.</p>

<p>The <code>-L</code> parameter then defines the port to be forwarded, from where, to where. So <code>127.0.0.2:8080:10.100.80.34:8080</code> means from the local “loopback” interface for 127.0.0.2, port 8080, to the remote host 10.100.80.341, port 8080. The second IP address will vary from deployment to deployment as each gets its own unique private IP addresses inside the private LAN.</p>

<p>There are three nodes set up for failover here, so three “-L” parameters are set with slightly different IP addresses. If you copy and paste the string into your terminal and let it run, it will configure a tunnel. Unless you are on a Mac that is…</p>

<h2 id="amacosxnote">A Mac OS X Note</h2>

<p>Mac users, there’s a step you will need to take before this though because Apple does things slightly differently. On most Unix-like systems, all the addresses 127.0.0.1 to 255 are available as network loopback addresses (only connecting locally), but Apple decided to keep things simple and only set up 127.0.0.1. That means that you’ll have to configure the other addresses as aliases of 127.0.0.1. If you don’t do that, you’ll be told that SSH can’t bind to the port. So for each loopback you want to configure you need to do:</p>

<pre><code>sudo ifconfig lo0 alias 127.0.0.2 up  
</code></pre>

<p>That, of course, configures the 127.0.0.2 address. This command needs admin privilege, so is preceded by the “sudo” command and it should prompt you for an admin password. Repeat as needed, usually for 127.0.0.3 and 127.0.0.4. This change doesn’t survive a reboot so either add it to a script that you use to configure the tunnel or create a launchd service. The former is easiest, and we’ll cover the latter in follow-up article.</p>

<aside class="right-gutter">If you have downloaded and have RethinkDB running on Mac OS X locally, you will need to stop it. By default the local server will bind to all your 127.x.x.x addresses stopping you from tunnelling through</aside>  

<h2 id="connectingthetunnel">Connecting The Tunnel</h2>

<p>Once you’ve executed your SSH connect string command, you may be asked for the passphrase to allow your key to be used. If there are no errors you’ll be ready to connect to the admin UI of RethinkDB. Fire up your web browser and point it at 127.0.0.2:8080 and you should meet the RethinkDB admin page:</p>

<p><img src="../content/images/2014/12/Screenshot-2014-10-08-15_24_13_as3ztl_yqv2tx.png" alt="RethinkDB Admin" title="">The other connect string in the Overview will let client drivers from JavaScript, Python, Ruby or any other driver connect to the database. The difference is that they use port 28015 to connect to RethinkDB, so you need to forward that port between your system and your Compose RethinkDB deployment. You can combine the connect strings too, bringing all the -L parameters into one command like say:</p>

<pre><code>ssh -N compose@portal.0.dblayer.com -p 10021  
-L 127.0.0.2:28015:10.100.80.34:28015 
-L 127.0.0.3:28015:10.100.80.35:28015 
-L 127.0.0.4:28015:10.100.80.36:28015 
-L 127.0.0.2:8080:10.100.80.34:8080 
-L 127.0.0.3:8080:10.100.80.35:8080 
-L 127.0.0.4:8080:10.100.80.36:8080 
</code></pre>

<p>and this will set up the tunnel for the Admin UI and the driver ports.</p>

<p>Now you can tunnel your way to your Compose RethinkDB deployment and enjoy the rich, powerful database technology from your browser and from your applications.</p>


<footer class="post-footer big-push">


    <figure class="author">
      <a href="../author/dj/">
        <img src="http://www.gravatar.com/avatar/3c427b45eb4d51770a5ec7f9e4d62c9f?d=404&amp;s=250" alt="Dj">
      </a>
      <figcaption>
        <p>Written on <time class="post-date" datetime="2015-03-13">March 13th, 2015</time> by</p>
        <a href="../author/dj/">Dj</a>
          <p>Content Curator at Compose, Dj has been both a developer and writer since Apples came in ][ flavors and Commodores had Pets.</p>
      </figcaption>
    </figure>




  <nav class="post-nav">
    <section class="site-nav">
      <a class="article-index" data-tooltip="Article Index" href="http://localhost:2368">
        <span class="hidden">Article Index</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#index"></use>
        </svg>
      </a>
      <a class="subscribe-button" data-tooltip="Suscribe" href="http://localhost:2368/rss/">
        <span class="hidden">Subscribe</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#subscribe"></use>
        </svg>
      </a>
    </section>
    <section class="share-nav">
      <a class="twitter-button" data-tooltip="Share on Twitter" href="https://twitter.com/share?text=Connecting%20to%20Compose's%20RethinkDB%20deployments%20with%20SSH&amp;url=http://localhost:2368/connecting-to-composes-rethinkdb-deployments-with-ssh/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#twitter"></use>
        </svg>
      </a>
      <a class="facebook-button" data-tooltip="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:2368/connecting-to-composes-rethinkdb-deployments-with-ssh/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#facebook"></use>
        </svg>
      </a>
      <a class="google-plus-button" data-tooltip="Share on Google Plus" href="https://plus.google.com/share?url=http://localhost:2368/connecting-to-composes-rethinkdb-deployments-with-ssh/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#google-plus"></use>
        </svg>
      </a>
    </section></nav>
  
</footer>

</article>



  </main>

  <footer class="colophon full-push" role="contentinfo">
    <nav>
      <dl>
        <dt>Company</dt>
        <dd><a href="http://127.0.0.1:2368/about-us/">About Us</a><a href="http://blog.compose.io/">Blog</a><a href="http://docs.compose.io/policies">Policies</a><a href="http://127.0.0.1:2368/pricing/">Plans <span class="amp">&amp;</span> Pricing </a><a href="http://127.0.0.1:2368/database-as-a-service/">Database as a Service</a>
        </dd>
      </dl>
      <dl>
        <dt>Support</dt>
        <dd><a href="http://status.compose.io/">System Status</a><a href="http://docs.compose.io/">Support</a><a href="http://docs.compose.io/">Docs</a><a href="http://127.0.0.1:2368/security/">Security</a><a href="https://docs.compose.io/support/new_request.html/?page=www">Contact Us</a>
        </dd>
      </dl>
      <dl>
        <dt>Databases</dt>
        <dd><a href="http://127.0.0.1:2368/mongodb/">MongoDB</a><a href="http://127.0.0.1:2368/elasticsearch/">Elasticsearch</a><a href="http://127.0.0.1:2368/rethinkdb/">RethinkDB</a><a href="http://127.0.0.1:2368/redis/">Redis</a><a href="http://127.0.0.1:2368/enhanced/">Enhanced</a>
        </dd>
      </dl>
      <dl>
        <dt>Deployments</dt>
        <dd><a href="http://127.0.0.1:2368/aws/">AWS</a><a href="http://127.0.0.1:2368/digitalocean/">DigitalOcean</a><a href="http://127.0.0.1:2368/softlayer/">SoftLayer</a><a href="http://127.0.0.1:2368/gogrid/">GoGrid</a>
        </dd>
      </dl>
    </nav>
    <p>© 2015 Compose. All rights reserved. </p>
  </footer>
  <script src="../public/jquery.js?v=682061ecfb"></script>

  <script type="text/javascript" src="../assets/js/site.js?v=682061ecfb"></script>

</body>
