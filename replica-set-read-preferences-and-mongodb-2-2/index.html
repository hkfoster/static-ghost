
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Replica Set Read Preferences and MongoDB 2.2</title>
  <meta name="description" content="">

  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="shortcut icon" href="../favicon.ico">

  <script>
  // Uncomment for testing purposes
  // localStorage.clear();
  
  // Place in <head> above all stylesheet declarations
  function loadFont( fontName, woffUrl, woff2Url ) {
  
    // Test for support
    var browser   = navigator.userAgent,
        noSupport = !window.addEventListener || ( browser.match( /(Android (2|3|4.0|4.1|4.2|4.3))|(Opera (Mini|Mobi))/ ) && !browser.match( /Chrome/ ) );
  
    // Return if not supported
    if ( noSupport ) {
      return;
    }
  
    // Set up localStorage
    var loSto = {};
    try {
      loSto = localStorage || {};
    } catch ( ex ) {}
  
    var localStoragePrefix = 'x-font-' + fontName,
        localStorageUrlKey = localStoragePrefix + 'url',
        localStorageCssKey = localStoragePrefix + 'css',
        storedFontUrl      = loSto[ localStorageUrlKey ],
        storedFontCss      = loSto[ localStorageCssKey ];
  
    // Set up <style> element
    var styleElement = document.createElement( 'style' );
    styleElement.rel = 'stylesheet';
    document.head.appendChild( styleElement );
  
    // localStorage check
    if ( storedFontCss && ( storedFontUrl === woffUrl || storedFontUrl === woff2Url ) ) {
  
      // Apply font style sheet
      styleElement.textContent = storedFontCss;
  
    } else {
  
      // Apply new font (WOFF2 if supported)
      var url = ( woff2Url && supportsWoff2() ) ? woff2Url : woffUrl;
  
      // Fetch font data
      var request = new XMLHttpRequest();
      request.open( 'GET', url );
      request.onload = function() {
        if ( request.status >= 200 && request.status < 400 ) {
  
          // Update localStorage
          loSto[ localStorageUrlKey ] = url;
          loSto[ localStorageCssKey ] = styleElement.textContent = request.responseText;
        }
      };
      request.send();
    }
  
    // Check for WOFF2 support
    function supportsWoff2() {
      if ( !window.FontFace ) {
        return false;
      }
  
      var f = new FontFace( 't', 'url( "data:application/font-woff2," ) format( "woff2" )' );
      f.load();
  
      return f.status === 'loading';
    }
  }
  
  // Instantiate font loader
  loadFont(
    'Proxima Nova',
    '/assets/css/fonts-woff.css?v=682061ecfb',
    '/assets/css/fonts-woff2.css?v=682061ecfb'
  );
  </script>
  <link rel="stylesheet" type="text/css" href="../assets/css/style.css?v=682061ecfb">

  <link rel="canonical" href="http://localhost:2368/replica-set-read-preferences-and-mongodb-2-2/">
    
    <meta property="og:site_name" content="Compose Articles">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Replica Set Read Preferences and MongoDB 2.2">
    <meta property="og:description" content="When making the transition from a single server setup to a Replica Set there are many more benefits than just a hot standby. Read preferences are one that should be heavily considered. Benefits vary from reducing system load and/or...">
    <meta property="og:url" content="http://localhost:2368/replica-set-read-preferences-and-mongodb-2-2/">
    <meta property="article:published_time" content="2013-01-15T21:16:26.000Z">
    <meta property="article:modified_time" content="2013-05-03T03:46:53.000Z">
    <meta property="article:tag" content="10gen">
    <meta property="article:tag" content="conference">
    <meta property="article:tag" content="mongo hosting">
    <meta property="article:tag" content="mongoconf">
    <meta property="article:tag" content="mongodb">
    <meta property="article:tag" content="mongodb hosting">
    <meta property="article:tag" content="mongohq">
    <meta property="article:tag" content="mongosv">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Replica Set Read Preferences and MongoDB 2.2">
    <meta name="twitter:description" content="When making the transition from a single server setup to a Replica Set there are many more benefits than just a hot standby. Read preferences are one that should be heavily considered. Benefits vary from reducing system load and/or...">
    <meta name="twitter:url" content="http://localhost:2368/replica-set-read-preferences-and-mongodb-2-2/">
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Compose Articles",
    "author": {
        "@type": "Person",
        "name": "dusty",
        "image": "//www.gravatar.com/avatar/d41ea0187231c745351ec7648903cd2e?d=404&s=250",
        "url": "http://localhost:2368/author/dusty",
        "sameAs": ""
    },
    "headline": "Replica Set Read Preferences and MongoDB 2.2",
    "url": "http://localhost:2368/replica-set-read-preferences-and-mongodb-2-2/",
    "datePublished": "2013-01-15T21:16:26.000Z",
    "dateModified": "2013-05-03T03:46:53.000Z",
    "keywords": "10gen, conference, mongo hosting, mongoconf, mongodb, mongodb hosting, mongohq, mongosv",
    "description": "When making the transition from a single server setup to a Replica Set there are many more benefits than just a hot standby. Read preferences are one that should be heavily considered. Benefits vary from reducing system load and/or..."
}
    </script>

    <meta name="generator" content="Ghost 0.5">
    <link rel="alternate" type="application/rss+xml" title="Compose Articles" href="http://localhost:2368/rss/">
</head>

<body class="post-template tag-10gen tag-conference tag-mongo-hosting tag-mongoconf tag-mongodb tag-mongodb-hosting tag-mongohq tag-mongosv blend-mode">

  <header class="branding" role="banner">
    <a class="logo" href="../"><span class="hidden">Compose</span></a>
    <a class="menu-trigger" href="index.html#?"></a>
    <nav class="main-nav" data-yield="primary_nav" role="navigation">
      <a href="http://127.0.0.1:2368/mongodb/">MongoDB</a>
      <a href="http://127.0.0.1:2368/elasticsearch/">Elasticsearch</a>
      <a href="http://127.0.0.1:2368/rethinkdb/">RethinkDB</a>
      <a href="http://127.0.0.1:2368/redis/">Redis</a>
      <a href="http://127.0.0.1:2368/postgresql/">PostgreSQL</a>
      <a href="https://app.compose.io">Sign in</a>
      <a class="signup" href="../signup/">Sign up</a>
    </nav>
  </header>
  <main class="content container" role="main">

    


<article class="post tag-10gen tag-conference tag-mongo-hosting tag-mongoconf tag-mongodb tag-mongodb-hosting tag-mongohq tag-mongosv container">
  <header>
    <h1 class="post-title">Replica Set Read Preferences and MongoDB 2.2</h1>
    <small class="post-meta"><time class="post-date" datetime="2013-01-15">January 15th, 2013</time></small>
  </header>

<p>When making the transition from a single server setup to a Replica Set there are many more benefits than just a hot standby. Read preferences are one that should be heavily considered. Benefits vary from reducing system load and/or network throughput on the primary to location based reads that are based on latency from the client. There are several options for configuring read preferences and different reasons why you might choose one over another.</p>

<p>Recent versions MongoDB have included support for sending read operations to the secondary member but with the release of 2.2 three new modes were added. These include primaryPreferred, secondaryPreferred and nearest. As in prior versions these can be applied to per connection, collection or operation.</p>

<h2 id="readpreferencemodes">Read preference modes:</h2>

<dl><dt>primary</dt><dd>The default. Send all read operations to primary even if primary is unavalialbe, thus failing. This would be used when stale results are not a option.</dd><dt>primaryPreferred (NEW)</dt><dd>Similar to the default although when the primary is unavaliable read operations are sent to the secondary. This provides some level of uptime during the transition from secondary -&gt; primary during a failover. Although failovers don’t occur that often one must be prepared.</dd><dt>secondary</dt><dd>Send all read operations to secondary. If secondary is unavailble the operation will fail.</dd><dt>secondaryPreferred (NEW)</dt><dd>Send all read operations to secondary unless secondary is unavailble. When the secondaryu is unavailable reads are sent to the primary.</dd><dt>nearest</dt><dd>Read operations are sent to the nearst member using the member selection [http://docs.mongodb.org/manual/applications/replication/#replica-set-read-preference-behavior-nearest](http://docs.mongodb.org/manual/applications/replication/#replica-set-read-preference-behavior-nearest) process. Could be used when stale results are acceptable and low latency is a priority.</dd></dl>  

<h2 id="driverexamplesruby">Driver examples (Ruby):</h2>

<p></p><dl><dt>per connection</dt><dd>When specifying the read preference in the connection all future objects will inhereit this preference unless specifically set.<code>
&lt;code data-language="ruby"&gt;db = <br>
Mongo::ReplSetConnection.new(['host.m0.mongohq.com:10011','host.m1.mongohq.com:10011'], <br>
:read =&gt; :secondary_preferred).db("myapp")
</code>

<p></p></dd><dt>per collection</dt><dd><code>
&lt;code data-language="ruby"&gt;db = <br>
Mongo::ReplSetConnection.new(['host.m0.mongohq.com:10011','host.m1.mongohq.com:10011'], <br>
:read =&gt; :primary).db("myapp")
auth = db.authenticate("user","password") <br>
staging = db.collection('staging') <br>
staging.find({:customer_name =&gt; 'John'}, :read =&gt; <br>
:secondary_preferred)</code>

<p></p></dd></dl>Other driver documentation can be found here: <a href="http://api.mongodb.org/">http://api.mongodb.org</a>

<p>As you can see the new modes offer more flexibility to where your reads operation take place. Although most applications perform well without configuring read preference fine tunning for growth may solve future issues.</p>


<footer class="post-footer big-push">


    <figure class="author">
      <a href="http://127.0.0.1:2368/author/dusty/">
        <img src="http://www.gravatar.com/avatar/d41ea0187231c745351ec7648903cd2e?d=404&amp;s=250" alt="dusty">
      </a>
      <figcaption>
        <p>Written on <time class="post-date" datetime="2015-03-13">March 13th, 2015</time> by</p>
        <a href="http://127.0.0.1:2368/author/dusty/">dusty</a>
          <p>0</p>
      </figcaption>
    </figure>




  <nav class="post-nav">
    <section class="site-nav">
      <a class="article-index" data-tooltip="Article Index" href="http://localhost:2368">
        <span class="hidden">Article Index</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#index"></use>
        </svg>
      </a>
      <a class="subscribe-button" data-tooltip="Suscribe" href="http://localhost:2368/rss/">
        <span class="hidden">Subscribe</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#subscribe"></use>
        </svg>
      </a>
    </section>
    <section class="share-nav">
      <a class="twitter-button" data-tooltip="Share on Twitter" href="https://twitter.com/share?text=Replica%20Set%20Read%20Preferences%20and%20MongoDB%202.2&amp;url=http://localhost:2368/replica-set-read-preferences-and-mongodb-2-2/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#twitter"></use>
        </svg>
      </a>
      <a class="facebook-button" data-tooltip="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:2368/replica-set-read-preferences-and-mongodb-2-2/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#facebook"></use>
        </svg>
      </a>
      <a class="google-plus-button" data-tooltip="Share on Google Plus" href="https://plus.google.com/share?url=http://localhost:2368/replica-set-read-preferences-and-mongodb-2-2/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
        <svg>
          <use xlink:href="/assets/images/icons.svg#google-plus"></use>
        </svg>
      </a>
    </section></nav>
  
</footer>

</article>



  </main>

  <footer class="colophon full-push" role="contentinfo">
    <nav>
      <dl>
        <dt>Company</dt>
        <dd><a href="http://127.0.0.1:2368/about-us/">About Us</a><a href="http://blog.compose.io/">Blog</a><a href="http://docs.compose.io/policies">Policies</a><a href="http://127.0.0.1:2368/pricing/">Plans <span class="amp">&amp;</span> Pricing </a><a href="http://127.0.0.1:2368/database-as-a-service/">Database as a Service</a>
        </dd>
      </dl>
      <dl>
        <dt>Support</dt>
        <dd><a href="http://status.compose.io/">System Status</a><a href="http://docs.compose.io/">Support</a><a href="http://docs.compose.io/">Docs</a><a href="http://127.0.0.1:2368/security/">Security</a><a href="https://docs.compose.io/support/new_request.html/?page=www">Contact Us</a>
        </dd>
      </dl>
      <dl>
        <dt>Databases</dt>
        <dd><a href="http://127.0.0.1:2368/mongodb/">MongoDB</a><a href="http://127.0.0.1:2368/elasticsearch/">Elasticsearch</a><a href="http://127.0.0.1:2368/rethinkdb/">RethinkDB</a><a href="http://127.0.0.1:2368/redis/">Redis</a><a href="http://127.0.0.1:2368/enhanced/">Enhanced</a>
        </dd>
      </dl>
      <dl>
        <dt>Deployments</dt>
        <dd><a href="http://127.0.0.1:2368/aws/">AWS</a><a href="http://127.0.0.1:2368/digitalocean/">DigitalOcean</a><a href="http://127.0.0.1:2368/softlayer/">SoftLayer</a><a href="http://127.0.0.1:2368/gogrid/">GoGrid</a>
        </dd>
      </dl>
    </nav>
    <p>© 2015 Compose. All rights reserved. </p>
  </footer>
  <script src="../public/jquery.js?v=682061ecfb"></script>

  <script type="text/javascript" src="../assets/js/site.js?v=682061ecfb"></script>

</body>
